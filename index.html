<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>APUNTADO</title>

<style>
:root{
  --bg:#000;
  --fg:#fff;
  --line:#333;
  --green:#1f7a3f;
  --red:#7a1f1f;
  --gold:#d4af37;
  --orange:#b87333;
}

*{box-sizing:border-box;font-family:system-ui,-apple-system,BlinkMacSystemFont;}

body{
  margin:0;
  background:var(--bg);
  color:var(--fg);
}

header{
  padding:10px;
  display:flex;
  gap:10px;
  align-items:center;
}

select,button,input{
  background:#000;
  color:#fff;
  border:1px solid var(--line);
  padding:6px 10px;
  font-size:16px;
}

button{
  cursor:pointer;
}

#players{
  display:grid;
  gap:10px;
  padding:10px;
}

.player{
  border:1px solid var(--line);
  padding:8px;
}

.player.inactive{
  opacity:.3;
  pointer-events:none;
}

.player.winner{
  border-color:var(--gold);
}

.name{
  font-weight:600;
}

.name.winner{
  font-weight:800;
}

.sep{
  border-top:1px solid var(--line);
  margin:6px 0;
}

.score{
  font-size:28px;
}

.controls{
  display:flex;
  gap:6px;
  margin-top:6px;
}

.controls button{
  flex:1;
}

footer{
  display:flex;
  gap:10px;
  padding:10px;
}

#undo{border-color:var(--orange);color:var(--orange);}
#reset{border-color:var(--red);color:var(--red);}
</style>
</head>

<body>

<header>
  <strong>APUNTADO</strong>
  <select id="playerCount">
    <option value="">Jugadores</option>
    <option>2</option><option>3</option><option>4</option>
    <option>5</option><option>6</option>
  </select>
</header>

<div id="players"></div>

<footer>
  <button id="undo">DESHACER</button>
  <button id="reset">REINICIAR</button>
</footer>

<script>
let state = JSON.parse(localStorage.getItem("apuntado")) || null;
let history = [];

const playersDiv = document.getElementById("players");
const countSelect = document.getElementById("playerCount");

function save(){ localStorage.setItem("apuntado", JSON.stringify(state)); }

function render(){
  playersDiv.innerHTML="";
  if(!state) return;

  state.players.forEach((p,i)=>{
    const d=document.createElement("div");
    d.className="player"+(p.inactive?" inactive":"")+(p.winner?" winner":"");

    const name=document.createElement("div");
    name.contentEditable=!p.inactive;
    name.className="name"+(p.winner?" winner":"");
    name.textContent=p.name;
    name.oninput=()=>{p.name=name.textContent;save();};

    const sep=document.createElement("div");
    sep.className="sep";

    const score=document.createElement("div");
    score.className="score";
    score.textContent=p.score;
    score.onclick=()=>{
      if(p.inactive) return;
      const val=prompt("¿Cuántos puntos?");
      if(val===null) return;
      history.push(JSON.stringify(state));
      p.score+=Number(val);
      checkWinner();
      save();
      render();
    };

    const controls=document.createElement("div");
    controls.className="controls";

    ["+","-"].forEach(sym=>{
      const b=document.createElement("button");
      b.textContent=sym;
      b.onclick=()=>{
        const v=prompt("Cantidad:");
        if(v===null) return;
        history.push(JSON.stringify(state));
        p.score+= sym==="+"?Number(v):-Number(v);
        checkWinner();
        save();
        render();
      };
      controls.appendChild(b);
    });

    if(p.winner){
      const w=document.createElement("div");
      w.textContent="GANADOR";
      w.style.color="var(--gold)";
      controls.appendChild(w);
    }

    d.append(name,sep,score,controls);
    playersDiv.appendChild(d);
  });
}

function checkWinner(){
  state.players.forEach(p=>p.winner=false);

  const active=state.players.filter(p=>!p.inactive);
  active.forEach(p=>{
    if(p.score<=-51){
      p.winner=true;
      active.forEach(o=>{if(o!==p)o.inactive=true;});
    }
  });

  const alive=active.filter(p=>p.score<=100);
  if(alive.length===1){
    alive[0].winner=true;
    active.forEach(o=>{if(o!==alive[0])o.inactive=true;});
  }
}

countSelect.onchange=()=>{
  const n=Number(countSelect.value);
  if(!n) return;
  state={players:[]};
  for(let i=1;i<=n;i++) state.players.push({name:"Jugador "+i,score:0,inactive:false,winner:false});
  save();
  render();
};

document.getElementById("undo").onclick=()=>{
  if(!history.length) return;
  state=JSON.parse(history.pop());
  save();render();
};

document.getElementById("reset").onclick=()=>{
  if(!confirm("¿Reiniciar juego?")) return;
  localStorage.removeItem("apuntado");
  state=null;
  history=[];
  playersDiv.innerHTML="";
  countSelect.value="";
};

if(state){
  countSelect.value=state.players.length;
  render();
}
</script>

</body>
</html>