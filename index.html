<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>APUNTADO</title>

<style>
* {
  box-sizing: border-box;
}

html, body {
  margin: 0;
  padding: 0;
  background: #000;
  color: #fff;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
  overflow-x: hidden;
}

/* margen lateral real */
.app {
  padding: 6px;
  max-width: 100vw;
}

/* HEADER */
header {
  text-align: center;
  margin-bottom: 10px;
}

header h1 {
  margin: 5px 0;
  font-size: 26px;
  letter-spacing: 2px;
}

/* CONTROLES SUPERIORES */
.top-controls {
  display: flex;
  gap: 6px;
  justify-content: center;
  margin-bottom: 10px;
}

select, button {
  background: #000;
  color: #fff;
  border: 1px solid #444;
  padding: 8px 10px;
  font-size: 14px;
}

button:active {
  transform: scale(0.97);
}

#undoBtn {
  border-color: #ff9800;
  color: #ff9800;
}

/* GRID JUGADORES */
.players {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 6px;
}

/* TARJETA JUGADOR */
.player {
  border: 1px solid #444;
  padding: 6px;
  display: flex;
  flex-direction: column;
  gap: 6px;
  min-height: 110px;
}

.player.inactive {
  opacity: 0.35;
  pointer-events: none;
}

.player.winner {
  border-color: gold;
}

.player.winner .name {
  font-weight: bold;
}

/* NOMBRE */
.name {
  text-align: center;
  font-size: 14px;
  text-transform: uppercase;
  outline: none;
}

.divider {
  height: 1px;
  background: #333;
}

/* PUNTAJE */
.score {
  text-align: center;
  font-size: 26px;
  outline: none;
}

/* ENTRADAS */
.entry {
  text-align: center;
  font-size: 11px;
  color: #ffeb3b;
}

/* CONTROLES JUGADOR */
.controls {
  display: flex;
  gap: 6px;
  justify-content: center;
}

.controls button {
  flex: 1;
  font-size: 16px;
}

/* FOOTER */
footer {
  margin-top: 10px;
  text-align: center;
}

#resetBtn {
  border-color: #ff3b3b;
  color: #ff3b3b;
}
</style>
</head>

<body>
<div class="app">

<header>
  <h1>APUNTADO</h1>
</header>

<div class="top-controls">
  <select id="playerCount">
    <option value="">JUGADORES</option>
    <option value="2">2</option>
    <option value="3">3</option>
    <option value="4">4</option>
    <option value="5">5</option>
    <option value="6">6</option>
  </select>

  <button id="undoBtn">DESHACER</button>
</div>

<div class="players" id="players"></div>

<footer>
  <button id="resetBtn">REINICIAR</button>
</footer>

</div>

<script>
let state = JSON.parse(localStorage.getItem("apuntado")) || null;
let history = [];

const playersDiv = document.getElementById("players");
const countSelect = document.getElementById("playerCount");

function save() {
  localStorage.setItem("apuntado", JSON.stringify(state));
}

function pushHistory() {
  history.push(JSON.stringify(state));
  if (history.length > 30) history.shift();
}

function undo() {
  if (!history.length) return;
  state = JSON.parse(history.pop());
  save();
  render();
}

function reset() {
  if (!confirm("¿REINICIAR JUEGO?")) return;
  localStorage.removeItem("apuntado");
  state = null;
  render();
}

document.getElementById("undoBtn").onclick = undo;
document.getElementById("resetBtn").onclick = reset;

countSelect.onchange = () => {
  const n = Number(countSelect.value);
  if (!n) return;

  state = {
    players: Array.from({ length: n }, (_, i) => ({
      name: `NOMBRE ${i + 1}`,
      score: 0,
      active: true,
      entry: false
    }))
  };
  save();
  render();
};

function render() {
  playersDiv.innerHTML = "";
  if (!state) return;

  state.players.forEach((p, i) => {
    const div = document.createElement("div");
    div.className = "player";
    if (!p.active) div.classList.add("inactive");

    // ganador
    if (p.score <= -51 || state.players.filter(x => x.active && x !== p).every(x => x.score >= 101)) {
      div.classList.add("winner");
      state.players.forEach(x => { if (x !== p) x.active = false; });
    }

    const name = document.createElement("div");
    name.className = "name";
    name.contentEditable = true;
    name.textContent = p.name;
    name.onfocus = () => selectAll(name);
    name.oninput = () => {
      pushHistory();
      p.name = name.textContent.toUpperCase();
      save();
    };

    const divider = document.createElement("div");
    divider.className = "divider";

    const score = document.createElement("div");
    score.className = "score";
    score.textContent = p.score;

    const entry = document.createElement("div");
    entry.className = "entry";
    entry.textContent = p.entry ? "ENTRADAS" : "";

    const controls = document.createElement("div");
    controls.className = "controls";

    const plus = document.createElement("button");
    plus.textContent = "+";
    plus.onclick = () => changeScore(i, true);

    const minus = document.createElement("button");
    minus.textContent = "−";
    minus.onclick = () => changeScore(i, false);

    controls.append(plus, minus);
    div.append(name, divider, score, entry, controls);
    playersDiv.appendChild(div);
  });
}

function changeScore(i, add) {
  const p = state.players[i];

  if (!p.active) {
    const enter = confirm("¿DESEA ENTRAR?");
    if (!enter) return;

    let val = prompt("¿CON CUÁNTOS PUNTOS ENTRA?");
    if (val === null) return;
    val = Number(val);
    if (isNaN(val)) return;

    pushHistory();
    p.score = val;
    p.active = true;
    p.entry = true;
    save();
    render();
    return;
  }

  let val = prompt(add ? "SUMAR PUNTOS" : "RESTAR PUNTOS");
  if (val === null) return;
  val = Number(val);
  if (isNaN(val)) return;

  pushHistory();
  p.score += add ? val : -val;
  save();
  render();
}

function selectAll(el) {
  const range = document.createRange();
  range.selectNodeContents(el);
  const sel = window.getSelection();
  sel.removeAllRanges();
  sel.addRange(range);
}

render();
</script>
</body>
</html>