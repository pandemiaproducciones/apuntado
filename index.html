<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>APUNTADO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
*{box-sizing:border-box;font-family:Arial,sans-serif}
body{margin:0;background:#000;color:#fff;min-height:100vh}

h1{text-align:center;letter-spacing:4px;margin:15px 0}

.top-controls{
  display:flex;
  justify-content:center;
  gap:12px;
  margin-bottom:10px;
}

select,button{
  background:#000;
  color:#fff;
  border:1px solid #333;
  border-radius:6px;
  padding:8px 12px;
  font-size:16px;
}

button{cursor:pointer}
button:disabled{opacity:.4;cursor:default}

.btn-undo{border-color:#b36b00;color:#ffb84d}
.btn-reset{border-color:#6b2f2f;color:#e5a0a0}

/* üëá margen lateral m√≠nimo para evitar recortes */
.players{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  grid-template-rows:repeat(3,1fr);
  height:calc(100vh - 200px);
  padding:0 2px; /* ‚Üê margen de seguridad */
}

.player{
  border:1px solid #222;
  padding:10px;
  display:flex;
  flex-direction:column;
  transition:.3s;
}

.player.disabled{opacity:.35;pointer-events:none}
.player.winner{border:2px solid #d4af37}

/* üëá bloque nombre + entradas centrado */
.name-block{
  display:flex;
  flex-direction:column;
  align-items:center;
}

.name{
  text-align:center;
  font-size:18px;
  font-weight:bold;
  background:transparent;
  border:none;
  color:#fff;
  outline:none;
  text-transform:uppercase;
}

.entradas{
  margin-top:4px;
  background:#ffeb3b;
  color:#000;
  font-size:14px;
  padding:2px 6px;
  border-radius:6px;
}

.divider{height:1px;background:#333;margin:8px 0}

.score-zone{
  flex:1;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  cursor:pointer;
}

.score{font-size:48px;font-weight:bold}
.score.out{color:#e55353}

.winner-label{
  margin-top:6px;
  color:#d4af37;
  font-weight:bold;
  letter-spacing:2px;
}

.bottom{
  display:flex;
  justify-content:center;
  padding:10px;
}

/* MODAL */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.85);
  display:none;
  align-items:center;
  justify-content:center;
}

.modal-box{
  background:#111;
  padding:20px;
  border-radius:10px;
  text-align:center;
  width:280px;
}

.modal-box input{
  width:100%;
  padding:12px;
  font-size:22px;
  text-align:center;
  background:#000;
  color:#fff;
  border:1px solid #333;
  margin-bottom:12px;
}

.modal-actions{
  display:flex;
  gap:10px;
}

.modal-actions button{flex:1}
.btn-yes{border-color:#2f6b3f;color:#9be5b1}
.btn-no{border-color:#6b2f2f;color:#e5a0a0}
</style>
</head>

<body>

<h1>APUNTADO</h1>

<div class="top-controls">
  <select id="count">
    <option value="">Jugadores</option>
    <option value="2">2</option><option value="3">3</option>
    <option value="4">4</option><option value="5">5</option>
    <option value="6">6</option>
  </select>
  <button class="btn-undo" id="undo" disabled>DESHACER</button>
</div>

<div class="players" id="players"></div>

<div class="bottom">
  <button class="btn-reset" onclick="resetGame()">REINICIAR</button>
</div>

<div class="modal" id="modal">
  <div class="modal-box">
    <div id="modalText"></div>
    <input id="modalInput" type="number" inputmode="numeric">
    <div class="modal-actions" id="modalActions"></div>
  </div>
</div>

<script>
let state=JSON.parse(localStorage.getItem("apuntado"))||{
  count:0,players:[],history:[],winner:null
};

const playersDiv=document.getElementById("players");
const countSel=document.getElementById("count");
const undoBtn=document.getElementById("undo");
const modal=document.getElementById("modal");
const modalText=document.getElementById("modalText");
const modalInput=document.getElementById("modalInput");
const modalActions=document.getElementById("modalActions");

function save(){localStorage.setItem("apuntado",JSON.stringify(state))}
function snapshot(){state.history.push(JSON.stringify(state));undoBtn.disabled=false}

function render(){
  playersDiv.innerHTML="";
  if(!state.count)return;

  state.players.forEach((p,i)=>{
    const d=document.createElement("div");
    d.className="player";
    if(state.winner!==null){
      if(i===state.winner)d.classList.add("winner");
      else d.classList.add("disabled");
    }else if(p.disabled)d.classList.add("disabled");

    d.innerHTML=`
      <div class="name-block">
        <input class="name" value="${p.name}">
        ${p.entradas?`<div class="entradas">ENTRADAS: ${p.entradas}</div>`:""}
      </div>
      <div class="divider"></div>
      <div class="score-zone">
        <div class="score ${p.out?"out":""}">${p.score}</div>
        ${state.winner===i?'<div class="winner-label">GANADOR</div>':""}
      </div>
    `;

    d.querySelector(".name").oninput=e=>{
      p.name=e.target.value.toUpperCase();save()
    };

    d.querySelector(".score-zone").onclick=()=>{
      openScore(i)
    };

    playersDiv.appendChild(d);
  });
}

function openScore(i){
  modalText.textContent="Puntos";
  modalInput.value="";
  modal.style.display="flex";
  modalInput.focus();
  modalActions.innerHTML=`
    <button onclick="apply(${i},1)">SUMAR</button>
    <button onclick="apply(${i},-1)">RESTAR</button>
  `;
}

function apply(i,m){
  const v=parseInt(modalInput.value);
  if(isNaN(v))return;
  snapshot();
  state.players[i].score+=v*m;
  modal.style.display="none";
  checkState();
  save();render();
}

function checkState(){
  state.players.forEach((p,i)=>{
    if(p.score<=-51)state.winner=i;
    if(p.score>=101&&!p.disabled)askReentry(i);
  });
  const active=state.players.filter(p=>!p.disabled).length;
  if(active===1)state.winner=state.players.findIndex(p=>!p.disabled);
}

function askReentry(i){
  modalText.textContent=`${state.players[i].name} ¬øDesea ingresar nuevamente?`;
  modalInput.style.display="none";
  modalActions.innerHTML=`
    <button class="btn-yes" onclick="reenter(${i})">SI</button>
    <button class="btn-no" onclick="reject(${i})">NO</button>
  `;
  modal.style.display="flex";
}

function reenter(i){
  modalText.textContent="¬øCon cu√°ntos puntos entra?";
  modalInput.style.display="block";
  modalInput.value="";
  modalInput.focus();
  modalActions.innerHTML=`
    <button class="btn-yes" onclick="setEntry(${i})">ENTRAR</button>
  `;
}

function setEntry(i){
  const v=parseInt(modalInput.value);
  if(isNaN(v))return;
  snapshot();
  const p=state.players[i];
  p.score=v;p.out=false;p.disabled=false;
  p.entradas=(p.entradas||0)+1;
  modal.style.display="none";
  save();render();
}

function reject(i){
  snapshot();
  state.players[i].disabled=true;
  state.players[i].out=true;
  modal.style.display="none";
  checkState();save();render();
}

countSel.onchange=()=>{
  state.count=parseInt(countSel.value);
  state.players=[];
  for(let i=0;i<state.count;i++){
    state.players.push({name:`NOMBRE ${i+1}`,score:0,entradas:0,disabled:false,out:false});
  }
  save();render();
};

undoBtn.onclick=()=>{
  if(!state.history.length)return;
  state=JSON.parse(state.history.pop());
  save();render();
};

function resetGame(){
  if(confirm("¬øReiniciar juego?")){
    localStorage.removeItem("apuntado");
    location.reload();
  }
}

render();
</script>
</body>
</html>