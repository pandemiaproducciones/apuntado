<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>APUNTADO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
* { box-sizing: border-box; font-family: Arial, sans-serif; }

body { margin: 0; background: #000; color: #fff; }

header { text-align: center; padding: 15px 10px 5px; }
h1 { margin: 5px 0 10px; letter-spacing: 4px; }

.controls {
  display: flex;
  justify-content: center;
  gap: 10px;
}

select, button {
  background: #000;
  color: #fff;
  border: 1px solid #333;
  padding: 8px 12px;
  border-radius: 6px;
  font-size: 16px;
}

button:disabled { opacity: .4; }

.btn-save.active {
  background: #2f6b3f;
  color: #fff;
  border-color: #2f6b3f;
}

.players {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  grid-template-rows: repeat(3, 1fr);
  height: calc(100vh - 170px);
}

.player {
  border: 1px solid #222;
  padding: 10px;
  display: flex;
  flex-direction: column;
}

.player.disabled {
  opacity: .35;
  pointer-events: none;
}

.player.winner { border: 2px solid #d4af37; }

.name-zone input {
  width: 100%;
  background: transparent;
  border: none;
  color: #fff;
  text-align: center;
  font-size: 18px;
}

.entradas {
  margin-top: 4px;
  background: #ffeb3b;
  color: #000;
  font-size: 13px;
  font-weight: bold;
  padding: 2px 6px;
  border-radius: 6px;
  width: fit-content;
  margin-inline: auto;
}

.divider { height: 1px; background: #333; margin: 8px 0; }

.score-zone {
  flex: 1;
  display: flex;
  justify-content: center;
  align-items: center;
}

.score { font-size: 48px; font-weight: bold; }
.score.out { color: #e55353; }

.winner-label {
  color: #d4af37;
  margin-top: 6px;
  font-weight: bold;
  letter-spacing: 2px;
  text-align: center;
}

.bottom {
  display: flex;
  justify-content: center;
  gap: 20px;
  padding: 10px;
}

.btn-danger { border-color: #6b2f2f; color: #e5a0a0; }

.modal, .overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,.85);
  display: none;
  align-items: center;
  justify-content: center;
  z-index: 10;
}

.modal-content, .overlay-box {
  background: #111;
  padding: 20px;
  border-radius: 10px;
  width: 90%;
  max-width: 320px;
  text-align: center;
}

.modal-content input {
  width: 100%;
  padding: 12px;
  font-size: 22px;
  text-align: center;
  background: #000;
  color: #fff;
  border: 1px solid #333;
}

.modal-buttons {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}

.modal-buttons button { flex: 1; }
</style>
</head>

<body>

<header>
  <h1>APUNTADO</h1>
  <div class="controls">
    <select id="count">
      <option value="">Jugadores</option>
      <option>2</option><option>3</option><option>4</option>
      <option>5</option><option>6</option>
    </select>
    <button id="saveBtn" class="btn-save" disabled>GUARDAR</button>
  </div>
</header>

<div class="players" id="players"></div>

<div class="bottom">
  <button class="btn-danger" onclick="undo()">DESHACER</button>
  <button class="btn-danger" onclick="reset()">REINICIAR</button>
</div>

<!-- SUMAR / RESTAR -->
<div class="modal" id="scoreModal">
  <div class="modal-content">
    <input id="scoreInput" type="number" inputmode="numeric">
    <div class="modal-buttons">
      <button onclick="applyScore(1)">SUMAR</button>
      <button onclick="applyScore(-1)">RESTAR</button>
    </div>
  </div>
</div>

<!-- REINGRESO SI / NO -->
<div class="overlay" id="reModal">
  <div class="overlay-box">
    <div id="reText"></div>
    <button onclick="reDecision(true)">SI</button>
    <button onclick="reDecision(false)">NO</button>
  </div>
</div>

<!-- PUNTOS DE ENTRADA -->
<div class="modal" id="entryModal">
  <div class="modal-content">
    <div>¿Con cuántos puntos entra?</div>
    <input id="entryInput" type="number" inputmode="numeric">
    <div class="modal-buttons">
      <button onclick="confirmEntry()">CONFIRMAR</button>
    </div>
  </div>
</div>

<script>
let history=[], currentScore=null, rePlayer=null;

const playersEl=document.getElementById("players");
const scoreModal=document.getElementById("scoreModal");
const reModal=document.getElementById("reModal");
const entryModal=document.getElementById("entryModal");

function build(){
  playersEl.innerHTML="";
  const n=document.getElementById("count").value;
  if(!n) return;
  for(let i=0;i<n;i++){
    playersEl.innerHTML+=`
    <div class="player" data-i="${i}" data-entries="0" data-reentered="false">
      <div class="name-zone"><input value="Nombre ${i+1}"></div>
      <div class="divider"></div>
      <div class="score-zone"><div class="score">0</div></div>
    </div>`;
  }
}

document.getElementById("count").onchange=build;

playersEl.onclick=e=>{
  const zone=e.target.closest(".score-zone");
  if(!zone) return;
  currentScore=zone.querySelector(".score");
  scoreModal.style.display="flex";
  const inp=document.getElementById("scoreInput");
  inp.value="";
  setTimeout(()=>inp.focus(),100);
};

function applyScore(m){
  history.push(playersEl.innerHTML);
  currentScore.textContent=parseInt(currentScore.textContent)+(parseInt(scoreInput.value)||0)*m;
  scoreModal.style.display="none";
  check();
}

function check(){
  document.querySelectorAll(".player").forEach(p=>{
    const s=p.querySelector(".score");
    if(parseInt(s.textContent)>=101 && p.dataset.reentered==="false"){
      rePlayer=p;
      document.getElementById("reText").textContent=
        p.querySelector("input").value+" ¿desea reingresar?";
      reModal.style.display="flex";
    }
  });
}

function reDecision(ok){
  reModal.style.display="none";
  if(!ok){
    rePlayer.classList.add("disabled");
    rePlayer.querySelector(".score").classList.add("out");
  } else {
    entryModal.style.display="flex";
    const inp=document.getElementById("entryInput");
    inp.value="";
    setTimeout(()=>inp.focus(),100);
  }
}

function confirmEntry(){
  const v=parseInt(entryInput.value);
  if(isNaN(v)) return;
  rePlayer.querySelector(".score").textContent=v;
  rePlayer.dataset.reentered="true";
  rePlayer.dataset.entries=parseInt(rePlayer.dataset.entries)+1;
  const label=document.createElement("div");
  label.className="entradas";
  label.textContent="ENTRADAS: "+rePlayer.dataset.entries;
  rePlayer.querySelector(".name-zone").appendChild(label);
  entryModal.style.display="none";
}

function undo(){
  if(!history.length) return;
  playersEl.innerHTML=history.pop();
}

function reset(){
  if(confirm("¿Reiniciar juego?")) location.reload();
}
</script>

</body>
</html>